<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activiti系统功能验证</title>
    <style>
        :root {
            --primary-color: #1890ff;
            --success-color: #52c41a;
            --error-color: #ff4d4f;
            --warning-color: #faad14;
            --text-color: #333;
            --text-secondary: #595959;
            --text-light: #8c8c8c;
            --border-color: #e8e8e8;
            --background-light: #f5f5f5;
            --background-white: #ffffff;
            --shadow-light: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--background-white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
            font-weight: 600;
        }
        
        h2 {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #fafafa;
            transition: all 0.3s ease;
        }
        
        .test-section:hover {
            box-shadow: var(--shadow-light);
            border-color: var(--primary-color);
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .test-controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        input[type="text"], input[type="password"] {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            transition: border-color 0.3s;
            font-size: 14px;
        }
        
        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:hover:not(:disabled) {
            background-color: #40a9ff;
            transform: translateY(-1px);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            background-color: #d9d9d9;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .result {
            padding: 15px;
            background-color: #f0f2f5;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        .success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
        }
        
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
        }
        
        .info {
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
        }
        
        .test-description {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 15px;
            padding-left: 5px;
        }
        
        .connection-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            gap: 5px;
        }
        
        .status-connected {
            background-color: #f6ffed;
            color: var(--success-color);
            border: 1px solid #b7eb8f;
        }
        
        .status-disconnected {
            background-color: #fff2f0;
            color: var(--error-color);
            border: 1px solid #ffccc7;
        }
        
        .status-pending {
            background-color: #fffbe6;
            color: var(--warning-color);
            border: 1px solid #ffe58f;
        }
        
        .auth-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .api-test-card {
            background-color: var(--background-white);
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .api-test-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        
        .api-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .api-method {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            background-color: var(--primary-color);
            color: white;
        }
        
        .api-endpoint {
            font-family: 'Courier New', monospace;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .system-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .status-card {
            padding: 20px;
            border-radius: 6px;
            background-color: var(--background-white);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .status-card-title {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .status-card-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 5px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .section-grid {
                grid-template-columns: 1fr;
            }
            
            .test-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            input[type="text"], input[type="password"] {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Activiti前端功能测试</h1>
        
        <div class="test-section">
            <h2>系统状态检查</h2>
            <div class="test-title">
                连接状态检查
                <span id="connection-status" class="connection-status status-pending">正在检查...</span>
            </div>
            <div class="test-description">检查与后端API的基本连接是否正常</div>
            <div class="test-controls">
                <button id="check-connection-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                    重新检查连接
                </button>
            </div>
            <div id="connection-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>用户认证测试</h2>
            <div class="test-title">用户登录测试</div>
            <div class="test-description">使用Basic认证测试登录功能，系统支持的账户：admin/admin、salaboy/salaboy</div>
            <div class="test-controls">
                <input type="text" id="login-username" placeholder="用户名" value="admin">
                <input type="password" id="login-password" placeholder="密码" value="admin">
                <button id="login-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
                        <polyline points="21 3 12 12 9 9"></polyline>
                    </svg>
                    测试登录
                </button>
            </div>
            <div id="login-result" class="result"></div>
            <div id="auth-status" class="auth-status info" style="display: none;">
                <span>当前未登录</span>
                <button id="clear-auth-btn">清除认证</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>API功能测试</h2>
            <div class="test-title">基本API测试</div>
            <div class="test-description">测试基本的API端点是否可用</div>
            
            <div class="section-grid">
                <div class="api-test-card">
                    <div class="api-test-header">
                        <span class="api-method">GET</span>
                        <span class="api-endpoint">/hello</span>
                    </div>
                    <div class="test-controls">
                        <button id="test-hello-btn">测试端点</button>
                    </div>
                    <div id="hello-result" class="result"></div>
                </div>
                
                <div class="api-test-card">
                    <div class="api-test-header">
                        <span class="api-method">GET</span>
                        <span class="api-endpoint">/user/info</span>
                    </div>
                    <div class="test-controls">
                        <button id="test-user-info-btn">测试端点</button>
                    </div>
                    <div id="user-info-result" class="result"></div>
                </div>
                
                <div class="api-test-card">
                    <div class="api-test-header">
                        <span class="api-method">GET</span>
                        <span class="api-endpoint">/test</span>
                    </div>
                    <div class="test-controls">
                        <button id="test-test-btn">测试端点</button>
                    </div>
                    <div id="test-result" class="result"></div>
                </div>
                
                <div class="api-test-card">
                    <div class="api-test-header">
                        <span class="api-method">GET</span>
                        <span class="api-endpoint">/login</span>
                    </div>
                    <div class="test-controls">
                        <button id="test-login-endpoint-btn">测试端点</button>
                    </div>
                    <div id="login-endpoint-result" class="result"></div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>前端资源检查</h2>
            <div class="test-title">检查前端静态资源</div>
            <div class="test-description">验证关键前端文件是否存在且可访问</div>
            <div class="test-controls">
                <button id="check-frontend-resources-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
                        <polyline points="21 3 12 12 9 9"></polyline>
                    </svg>
                    检查前端资源
                </button>
            </div>
            <div id="frontend-resources-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>系统功能总结</h2>
            <div class="test-title">系统状态概览</div>
            
            <div class="system-status-grid">
                <div class="status-card">
                    <div class="status-card-title">后端连接</div>
                    <div class="status-card-value" id="backend-status-value">未知</div>
                    <div class="status-badge" id="backend-status-badge">检查中...</div>
                </div>
                
                <div class="status-card">
                    <div class="status-card-title">用户认证</div>
                    <div class="status-card-value" id="auth-status-value">未登录</div>
                    <div class="status-badge" id="auth-status-badge">未认证</div>
                </div>
                
                <div class="status-card">
                    <div class="status-card-title">API可用性</div>
                    <div class="status-card-value" id="api-availability-value">0/4</div>
                    <div class="status-badge" id="api-availability-badge">未测试</div>
                </div>
                
                <div class="status-card">
                    <div class="status-card-title">前端资源</div>
                    <div class="status-card-value" id="frontend-resources-value">未检查</div>
                    <div class="status-badge" id="frontend-resources-badge">未知</div>
                </div>
            </div>
            
            <div id="summary" class="result info">
                <h3>系统功能概述：</h3>
                <p>1. 认证系统：前端使用模拟的JWT认证，后端实际使用Basic认证</p>
                <p>2. 主要功能页面：dashboard.html（任务列表）、process-management.html（流程管理）</p>
                <p>3. API端点：/test、/hello、/login、/user/info</p>
                <p>4. 注意事项：部分Admin接口已暂时禁用，前端界面可能无法显示完整Activiti功能</p>
            </div>
        </div>
    </div>
    
    <script>
        // 全局状态管理
        const appState = {
            isConnected: false,
            isAuthenticated: false,
            currentUser: null,
            apiTests: {
                '/hello': { success: false, tested: false },
                '/user/info': { success: false, tested: false },
                '/test': { success: false, tested: false },
                '/login': { success: false, tested: false }
            },
            frontendResources: {}
        };
        
        // 更新系统状态面板
        function updateSystemStatus() {
            // 更新后端连接状态
            document.getElementById('backend-status-value').textContent = appState.isConnected ? '已连接' : '未连接';
            document.getElementById('backend-status-badge').textContent = appState.isConnected ? '正常' : '异常';
            document.getElementById('backend-status-badge').className = 'status-badge ' + (appState.isConnected ? 'status-connected' : 'status-disconnected');
            
            // 更新认证状态
            document.getElementById('auth-status-value').textContent = appState.isAuthenticated ? 
                appState.currentUser || '已登录' : '未登录';
            document.getElementById('auth-status-badge').textContent = appState.isAuthenticated ? '已认证' : '未认证';
            document.getElementById('auth-status-badge').className = 'status-badge ' + 
                (appState.isAuthenticated ? 'status-connected' : 'status-disconnected');
            
            // 更新API可用性
            const testedCount = Object.values(appState.apiTests).filter(test => test.tested).length;
            const successCount = Object.values(appState.apiTests).filter(test => test.success).length;
            document.getElementById('api-availability-value').textContent = `${successCount}/${testedCount || 4}`;
            document.getElementById('api-availability-badge').textContent = testedCount > 0 ? 
                `${Math.round((successCount / testedCount) * 100)}% 可用` : '未测试';
            
            // 更新前端资源状态
            const resourcesTested = Object.keys(appState.frontendResources).length > 0;
            const resourcesAvailable = resourcesTested ? 
                Object.values(appState.frontendResources).filter(resource => resource.available).length : 0;
            const resourcesTotal = resourcesTested ? Object.keys(appState.frontendResources).length : 0;
            document.getElementById('frontend-resources-value').textContent = resourcesTested ? 
                `${resourcesAvailable}/${resourcesTotal}` : '未检查';
            document.getElementById('frontend-resources-badge').textContent = resourcesTested ? 
                `${Math.round((resourcesAvailable / resourcesTotal) * 100)}% 可用` : '未知';
        }
        
        // 辅助函数：显示结果
        function showResult(elementId, content, isSuccess = true) {
            const element = document.getElementById(elementId);
            
            // 添加加载动画效果
            element.style.opacity = '0.6';
            setTimeout(() => {
                element.textContent = content;
                element.className = 'result ' + (isSuccess ? 'success' : 'error');
                element.style.opacity = '1';
            }, 300);
        }
        
        // 辅助函数：格式化JSON输出
        function formatJson(data) {
            try {
                if (typeof data === 'string') {
                    return JSON.stringify(JSON.parse(data), null, 2);
                }
                return JSON.stringify(data, null, 2);
            } catch (e) {
                return String(data);
            }
        }
        
        // 检查连接状态
        async function checkConnection() {
            const statusEl = document.getElementById('connection-status');
            const resultEl = document.getElementById('connection-result');
            
            statusEl.innerHTML = '<span>检查中...</span>';
            statusEl.className = 'connection-status status-pending';
            
            try {
                const response = await fetch('/test', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('connection-result', formatJson(data));
                    statusEl.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg><span>已连接</span>';
                    statusEl.className = 'connection-status status-connected';
                    appState.isConnected = true;
                } else {
                    const errorText = await response.text();
                    showResult('connection-result', `连接失败: HTTP ${response.status}\n${errorText}`, false);
                    statusEl.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg><span>未连接</span>';
                    statusEl.className = 'connection-status status-disconnected';
                    appState.isConnected = false;
                }
            } catch (error) {
                showResult('connection-result', `连接错误: ${error.message}`, false);
                statusEl.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg><span>未连接</span>';
                statusEl.className = 'connection-status status-disconnected';
                appState.isConnected = false;
            } finally {
                updateSystemStatus();
            }
        }
        
        // 测试登录
        async function testLogin() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            const authStatusEl = document.getElementById('auth-status');
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> 登录中...';
            
            try {
                const response = await fetch(`/login?username=${username}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa(username + ':' + password),
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showResult('login-result', formatJson(data));
                    
                    // 更新认证状态
                    authStatusEl.style.display = 'flex';
                    authStatusEl.querySelector('span').textContent = `已登录为: ${username}`;
                    authStatusEl.className = 'auth-status success';
                    
                    appState.isAuthenticated = true;
                    appState.currentUser = username;
                } else {
                    const errorText = await response.text();
                    showResult('login-result', `登录失败: HTTP ${response.status}\n${errorText}`, false);
                    
                    // 重置认证状态
                    authStatusEl.style.display = 'none';
                    appState.isAuthenticated = false;
                    appState.currentUser = null;
                }
            } catch (error) {
                showResult('login-result', `登录错误: ${error.message}`, false);
                
                // 重置认证状态
                authStatusEl.style.display = 'none';
                appState.isAuthenticated = false;
                appState.currentUser = null;
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><polyline points="21 3 12 12 9 9"></polyline></svg> 测试登录';
                updateSystemStatus();
            }
        }
        
        // 清除认证
        function clearAuth() {
            document.getElementById('auth-status').style.display = 'none';
            document.getElementById('login-result').textContent = '';
            document.getElementById('login-result').className = 'result';
            appState.isAuthenticated = false;
            appState.currentUser = null;
            updateSystemStatus();
        }
        
        // 测试API端点
        async function testApi(endpoint, resultElementId, method = 'GET') {
            const resultEl = document.getElementById(resultElementId);
            
            // 清空结果并显示加载状态
            resultEl.textContent = '测试中...';
            resultEl.className = 'result info';
            
            try {
                let headers = {
                    'Content-Type': 'application/json'
                };
                
                // 如果已认证，添加认证头
                if (appState.isAuthenticated) {
                    const username = document.getElementById('login-username').value;
                    const password = document.getElementById('login-password').value;
                    headers['Authorization'] = 'Basic ' + btoa(username + ':' + password);
                }
                
                const response = await fetch(endpoint, {
                    method: method,
                    headers: headers
                });
                
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    data = await response.text();
                }
                
                if (response.ok) {
                    showResult(resultElementId, formatJson(data));
                    appState.apiTests[endpoint].success = true;
                } else {
                    showResult(resultElementId, `失败: HTTP ${response.status}\n${typeof data === 'string' ? data : JSON.stringify(data)}`, false);
                    appState.apiTests[endpoint].success = false;
                }
                
                appState.apiTests[endpoint].tested = true;
            } catch (error) {
                showResult(resultElementId, `错误: ${error.message}`, false);
                appState.apiTests[endpoint].success = false;
                appState.apiTests[endpoint].tested = true;
            } finally {
                updateSystemStatus();
            }
        }
        
        // 检查前端资源
        async function checkFrontendResources() {
            const resultEl = document.getElementById('frontend-resources-result');
            resultEl.textContent = '检查中...';
            resultEl.className = 'result info';
            
            const resources = [
                { name: 'login.html', url: '/login.html' },
                { name: 'dashboard.html', url: '/dashboard.html' },
                { name: 'process-management.html', url: '/process-management.html' },
                { name: 'api.js', url: '/js/api.js' },
                { name: 'auth.js', url: '/js/auth.js' },
                { name: 'dashboard.js', url: '/js/dashboard.js' },
                { name: 'login.js', url: '/js/login.js' },
                { name: 'style.css', url: '/css/style.css' }
            ];
            
            const results = [];
            
            for (const resource of resources) {
                try {
                    const response = await fetch(resource.url, { method: 'HEAD' });
                    const available = response.ok;
                    results.push(`${resource.name}: ${available ? '✓ 可用' : '✗ 不可用'}`);
                    appState.frontendResources[resource.name] = { url: resource.url, available };
                } catch (error) {
                    results.push(`${resource.name}: ✗ 错误 (${error.message})`);
                    appState.frontendResources[resource.name] = { url: resource.url, available: false, error: error.message };
                }
            }
            
            showResult('frontend-resources-result', results.join('\n'), true);
            updateSystemStatus();
        }
        
        // 事件监听器
        document.addEventListener('DOMContentLoaded', function() {
            // 初始检查连接
            checkConnection();
            
            // 检查连接按钮
            document.getElementById('check-connection-btn').addEventListener('click', checkConnection);
            
            // 登录测试按钮
            document.getElementById('login-btn').addEventListener('click', testLogin);
            
            // 清除认证按钮
            document.getElementById('clear-auth-btn').addEventListener('click', clearAuth);
            
            // API测试按钮
            document.getElementById('test-hello-btn').addEventListener('click', function() {
                testApi('/hello', 'hello-result');
            });
            
            document.getElementById('test-user-info-btn').addEventListener('click', function() {
                testApi('/user/info', 'user-info-result');
            });
            
            document.getElementById('test-test-btn').addEventListener('click', function() {
                testApi('/test', 'test-result');
            });
            
            document.getElementById('test-login-endpoint-btn').addEventListener('click', function() {
                const username = document.getElementById('login-username').value;
                testApi(`/login?username=${username}`, 'login-endpoint-result');
            });
            
            // 前端资源检查按钮
            document.getElementById('check-frontend-resources-btn').addEventListener('click', checkFrontendResources);
            
            // 初始更新系统状态
            updateSystemStatus();
        });
    </script>
</body>
</html>