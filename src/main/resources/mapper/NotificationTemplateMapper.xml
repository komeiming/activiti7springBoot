<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itheima.activiti.mapper.NotificationTemplateMapper">
    
    <resultMap id="BaseResultMap" type="com.itheima.activiti.entity.NotificationTemplate">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="code" property="code"/>
        <result column="type" property="type"/>
        <result column="status" property="status"/>
        <result column="sender" property="sender"/>
        <result column="subject" property="subject"/>
        <result column="content" property="content"/>
        <result column="reply_to" property="replyTo"/>
        <result column="signature" property="signature"/>
        <result column="description" property="description"/>
        <result column="created_by" property="createdBy"/>
        <result column="created_at" property="createdTime"/>
        <result column="updated_by" property="updatedBy"/>
        <result column="updated_at" property="updatedTime"/>
    </resultMap>
    
    <sql id="Base_Column_List">
        id, name, code, type, status, sender, subject, content, reply_to, signature, description,
        created_by, created_at, updated_by, updated_at
    </sql>
    
    <select id="findByCondition" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        <where>
            <if test="id != null and id != ''">
                AND id = #{id}
            </if>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="type != null and type != ''">
                AND type = #{type}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        ORDER BY created_at DESC
    </select>
    
    <select id="findById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        WHERE id = #{id}
    </select>
    
    <select id="findByStatus" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        WHERE status = #{status}
        ORDER BY created_at DESC
    </select>
    
    <!-- 根据模板类型查询 -->
    <select id="findByType" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM notification_template
        WHERE type = #{type}
        ORDER BY created_at DESC
    </select>
    
    <!-- 更新模板状态 -->
    <update id="updateStatus">
        UPDATE notification_template
        SET status = #{status}
        WHERE id = #{id}
    </update>
    
    <!-- 查询所有模板 -->
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        ORDER BY created_at DESC
    </select>
    
    <!-- 根据ID查询模板 -->
    <select id="selectById" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        WHERE id = #{id}
    </select>
    
    <!-- 删除模板 -->
    <delete id="deleteById">
        DELETE FROM notification_template
        WHERE id = #{id}
    </delete>
    
    <!-- 插入模板 -->
    <insert id="insert">
        INSERT INTO notification_template (id, name, code, type, status, content, subject, sender, reply_to, signature, description, created_by, created_at, updated_by, updated_at)
        VALUES (#{id}, #{name}, #{code}, #{type}, #{status}, #{content}, #{subject}, #{sender}, #{replyTo}, #{signature}, #{description}, #{createdBy}, #{createdTime}, #{updatedBy}, #{updatedTime})
    </insert>
    
    <!-- 更新模板 -->
    <update id="update">
        UPDATE notification_template
        SET name = #{name}, code = #{code}, type = #{type}, status = #{status}, content = #{content}, subject = #{subject}, sender = #{sender}, reply_to = #{replyTo}, signature = #{signature}, description = #{description}, updated_by = #{updatedBy}, updated_at = #{updatedTime}
        WHERE id = #{id}
    </update>
    
    <!-- 根据状态查询模板 -->
    <select id="selectByStatus" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        WHERE status = #{status}
        ORDER BY created_at DESC
    </select>
    
    <!-- 根据类型查询模板 -->
    <select id="selectByType" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        WHERE type = #{type}
        ORDER BY created_at DESC
    </select>
    
    <!-- 根据条件查询模板 -->
    <select id="selectByParams" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM notification_template
        <where>
            <if test="id != null and id != ''">
                AND id = #{id}
            </if>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="code != null and code != ''">
                AND code LIKE CONCAT('%', #{code}, '%')
            </if>
            <if test="type != null and type != ''">
                AND type = #{type}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        ORDER BY created_at DESC
    </select>
</mapper>
