<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" 
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
             xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
             xmlns:activiti="http://activiti.org/bpmn" 
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" 
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" 
             typeLanguage="http://www.w3.org/2001/XMLSchema" 
             expressionLanguage="http://www.w3.org/1999/XPath" 
             targetNamespace="http://www.activiti.org/test">

  <process id="employeeOnboard" name="员工入职流程" isExecutable="true">
    
    <!-- 流程启动事件 -->
    <startEvent id="startEvent" name="开始">
      <extensionElements>
        <activiti:formProperty id="employeeName" name="员工姓名" type="string" required="true" />
        <activiti:formProperty id="employeeId" name="员工编号" type="string" required="true" />
        <activiti:formProperty id="department" name="所属部门" type="string" required="true" />
        <activiti:formProperty id="position" name="职位" type="string" required="true" />
        <activiti:formProperty id="hireDate" name="入职日期" type="date" required="true" />
        <activiti:formProperty id="managerName" name="汇报对象" type="string" required="true" />
        <activiti:formProperty id="managerId" name="汇报对象ID" type="string" required="true" />
      </extensionElements>
    </startEvent>
    
    <!-- 部门经理审批任务 -->
    <userTask id="managerApprovalTask" name="部门经理审批">
      <documentation>部门经理审批新员工入职申请</documentation>
      <extensionElements>
        <activiti:formProperty id="approval" name="是否批准" type="enum" required="true">
          <activiti:value id="approved" name="批准" />
          <activiti:value id="rejected" name="拒绝" />
        </activiti:formProperty>
        <activiti:formProperty id="comment" name="审批意见" type="string" />
        <activiti:assignee expression="${managerName}" />
      </extensionElements>
    </userTask>
    
    <!-- 排他网关 - 处理审批结果 -->
    <exclusiveGateway id="approvalGateway" name="审批结果" />
    
    <!-- HR确认任务 -->
    <userTask id="hrConfirmationTask" name="HR确认">
      <documentation>HR确认入职信息并准备相关材料</documentation>
      <extensionElements>
        <activiti:formProperty id="confirmed" name="是否确认" type="enum" required="true">
          <activiti:value id="yes" name="是" />
          <activiti:value id="no" name="否" />
        </activiti:formProperty>
        <activiti:formProperty id="hrComment" name="HR备注" type="string" />
        <activiti:candidateGroup>HR</activiti:candidateGroup>
      </extensionElements>
    </userTask>
    
    <!-- 资源准备任务 -->
    <userTask id="resourcePreparationTask" name="资源准备">
      <documentation>IT部门准备设备和系统账户</documentation>
      <extensionElements>
        <activiti:formProperty id="laptopPrepared" name="笔记本电脑准备" type="enum" required="true">
          <activiti:value id="yes" name="已准备" />
          <activiti:value id="no" name="未准备" />
        </activiti:formProperty>
        <activiti:formProperty id="accountCreated" name="系统账户创建" type="enum" required="true">
          <activiti:value id="yes" name="已创建" />
          <activiti:value id="no" name="未创建" />
        </activiti:formProperty>
        <activiti:formProperty id="officeAssigned" name="办公位分配" type="enum" required="true">
          <activiti:value id="yes" name="已分配" />
          <activiti:value id="no" name="未分配" />
        </activiti:formProperty>
        <activiti:candidateGroup>ADMIN</activiti:candidateGroup>
      </extensionElements>
    </userTask>
    
    <!-- 入职培训任务 -->
    <userTask id="trainingTask" name="入职培训">
      <documentation>安排和执行入职培训</documentation>
      <extensionElements>
        <activiti:formProperty id="trainingCompleted" name="培训完成" type="enum" required="true">
          <activiti:value id="yes" name="已完成" />
          <activiti:value id="no" name="未完成" />
        </activiti:formProperty>
        <activiti:formProperty id="trainingScore" name="培训评分" type="long" />
        <activiti:candidateGroup>TRAINER</activiti:candidateGroup>
      </extensionElements>
    </userTask>
    
    <!-- 入职完成事件 -->
    <endEvent id="onboardCompletedEvent" name="入职完成" />
    
    <!-- 流程拒绝事件 -->
    <endEvent id="processRejectedEvent" name="流程拒绝" />
    
    <!-- 排他网关 - 处理HR确认结果 -->
    <exclusiveGateway id="hrConfirmationGateway" name="HR确认结果" />
    
    <!-- 排他网关 - 处理资源准备结果 -->
    <exclusiveGateway id="resourcePreparationGateway" name="资源准备结果" />
    
    <!-- 排他网关 - 处理培训结果 -->
    <exclusiveGateway id="trainingGateway" name="培训结果" />
    
    <!-- 流程连接线 -->
    <sequenceFlow id="flow1" sourceRef="startEvent" targetRef="managerApprovalTask" />
    <sequenceFlow id="flow2" sourceRef="managerApprovalTask" targetRef="approvalGateway" />
    
    <!-- 审批通过分支 -->
    <sequenceFlow id="flow3" sourceRef="approvalGateway" targetRef="hrConfirmationTask">
      <conditionExpression xsi:type="tFormalExpression">${approval == 'approved'}</conditionExpression>
    </sequenceFlow>
    
    <!-- 审批拒绝分支 -->
    <sequenceFlow id="flow4" sourceRef="approvalGateway" targetRef="processRejectedEvent">
      <conditionExpression xsi:type="tFormalExpression">${approval == 'rejected'}</conditionExpression>
    </sequenceFlow>
    
    <sequenceFlow id="flow5" sourceRef="hrConfirmationTask" targetRef="hrConfirmationGateway" />
    
    <!-- HR确认通过分支 -->
    <sequenceFlow id="flow6" sourceRef="hrConfirmationGateway" targetRef="resourcePreparationTask">
      <conditionExpression xsi:type="tFormalExpression">${confirmed == 'yes'}</conditionExpression>
    </sequenceFlow>
    
    <!-- HR确认拒绝分支 -->
    <sequenceFlow id="flow7" sourceRef="hrConfirmationGateway" targetRef="processRejectedEvent">
      <conditionExpression xsi:type="tFormalExpression">${confirmed == 'no'}</conditionExpression>
    </sequenceFlow>
    
    <sequenceFlow id="flow8" sourceRef="resourcePreparationTask" targetRef="resourcePreparationGateway" />
    
    <!-- 资源准备完成分支 -->
    <sequenceFlow id="flow9" sourceRef="resourcePreparationGateway" targetRef="trainingTask">
      <conditionExpression xsi:type="tFormalExpression">${laptopPrepared == 'yes' &amp;&amp; accountCreated == 'yes' &amp;&amp; officeAssigned == 'yes'}</conditionExpression>
    </sequenceFlow>
    
    <!-- 资源准备未完成分支 -->
    <sequenceFlow id="flow10" sourceRef="resourcePreparationGateway" targetRef="resourcePreparationTask">
      <conditionExpression xsi:type="tFormalExpression">${laptopPrepared == 'no' || accountCreated == 'no' || officeAssigned == 'no'}</conditionExpression>
    </sequenceFlow>
    
    <sequenceFlow id="flow11" sourceRef="trainingTask" targetRef="trainingGateway" />
    
    <!-- 培训完成分支 -->
    <sequenceFlow id="flow12" sourceRef="trainingGateway" targetRef="onboardCompletedEvent">
      <conditionExpression xsi:type="tFormalExpression">${trainingCompleted == 'yes'}</conditionExpression>
    </sequenceFlow>
    
    <!-- 培训未完成分支 -->
    <sequenceFlow id="flow13" sourceRef="trainingGateway" targetRef="trainingTask">
      <conditionExpression xsi:type="tFormalExpression">${trainingCompleted == 'no'}</conditionExpression>
    </sequenceFlow>
  </process>

  <bpmndi:BPMNDiagram id="BPMNDiagram_employeeOnboard">
    <bpmndi:BPMNPlane bpmnElement="employeeOnboard" id="BPMNPlane_employeeOnboard">
      <bpmndi:BPMNShape bpmnElement="startEvent" id="BPMNShape_startEvent">
        <omgdc:Bounds height="30.0" width="30.0" x="100.0" y="163.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="managerApprovalTask" id="BPMNShape_managerApprovalTask">
        <omgdc:Bounds height="80.0" width="100.0" x="200.0" y="140.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="approvalGateway" id="BPMNShape_approvalGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="360.0" y="160.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="hrConfirmationTask" id="BPMNShape_hrConfirmationTask">
        <omgdc:Bounds height="80.0" width="100.0" x="460.0" y="140.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="resourcePreparationTask" id="BPMNShape_resourcePreparationTask">
        <omgdc:Bounds height="80.0" width="100.0" x="620.0" y="140.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="trainingTask" id="BPMNShape_trainingTask">
        <omgdc:Bounds height="80.0" width="100.0" x="780.0" y="140.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="onboardCompletedEvent" id="BPMNShape_onboardCompletedEvent">
        <omgdc:Bounds height="30.0" width="30.0" x="940.0" y="163.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="processRejectedEvent" id="BPMNShape_processRejectedEvent">
        <omgdc:Bounds height="30.0" width="30.0" x="365.0" y="300.0" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="130.0" y="178.0" />
        <omgdi:waypoint x="200.0" y="180.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="300.0" y="180.0" />
        <omgdi:waypoint x="360.0" y="180.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="380.0" y="180.0" />
        <omgdi:waypoint x="460.0" y="180.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="380.0" y="200.0" />
        <omgdi:waypoint x="380.0" y="300.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
        <omgdi:waypoint x="560.0" y="180.0" />
        <omgdi:waypoint x="620.0" y="180.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
        <omgdi:waypoint x="720.0" y="180.0" />
        <omgdi:waypoint x="780.0" y="180.0" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
        <omgdi:waypoint x="880.0" y="180.0" />
        <omgdi:waypoint x="940.0" y="178.0" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>